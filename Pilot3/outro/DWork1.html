{{ block title }}
    Survey
{{ endblock }}

{{ block content }}
<div style="display: flex; justify-content: center; margin-bottom: 18px;">
  <div style="width: 60%; background: #eee; border-radius: 6px; height: 24px;">
    <div style="width: {{ progress }}%; background: #3b82f6; height: 24px; border-radius: 6px; transition: width 0.2s;">
      <span style="color: black; font-weight: bold; padding-left: 10px;">{{ progress }}%</span>
    </div>
  </div>
</div>
</div>
<form method="post">

  <p>
    Do you think you have ever been subjected to discrimination <b>in the workplace</b> (e.g. in hiring, promotion, day-to-day treatment)?
    That is, do you think that you were treated differently (positively or negatively) because of some characteristic like your race, age, gender, disability status, religion etc.
    rather than because of your qualifications?<br><br>
    {{ form.discrim_work }}
  </p>

  <div id="followup_questions" style="display:none;">
    <p>
      In that case, based on which of the following do you think that you were treated differently in the workplace? (Select all that apply) <br><br>
      <div>
        <input type="checkbox" id="age" value="1" name="discrim_work_identity_age" />
        <label for="age">Age</label>
      </div>
      <div>
        <input type="checkbox" id="gender" value="1" name="discrim_work_identity_gender" />
        <label for="gender">Gender</label>
      </div>
      <div>
        <input type="checkbox" id="race" value="1" name="discrim_work_identity_race" />
        <label for="race">Race/Ethnicity</label>
      </div>
      <div>
        <input type="checkbox" id="religion" value="1" name="discrim_work_identity_religion" />
        <label for="religion">Religion</label>
      </div>
      <div>
        <input type="checkbox" id="disability" value="1" name="discrim_work_identity_disability" />
        <label for="disability">Disability</label>
      </div>
      <div>
        <input type="checkbox" id="sexual_orientation" value="1" name="discrim_work_identity_sex" />
        <label for="sexual_orientation">Sexual Orientation</label>
      </div>
      <div>
        <input type="checkbox" id="other" value="1" name="discrim_work_identity_other" />
        <label for="other">Other</label>
      </div>
    </p>

    <p>
      Do you think you were treated better or worse in the workplace because of these?<br><br>
      {{ form.discrim_work_pref }}
    </p>
  </div>

  <center>
    {{ next_button }}
  </center>

</form>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    let discrimInputs = document.querySelectorAll('input[name="discrim_work"]');
    let followupDiv = document.getElementById('followup_questions');

    function toggleFollowup() {
      let selectedValue = Array.from(discrimInputs).find(input => input.checked)?.value;
      if (selectedValue === '1') {
        followupDiv.style.display = 'block';
      } else {
        followupDiv.style.display = 'none';
        followupDiv.querySelectorAll('input[type=checkbox], input[type=radio]').forEach(input => input.checked = false);
        // Optionally clear the form.discrim_work_pref value as well, if not a checkbox/radio
        let select = followupDiv.querySelector('select[name="discrim_work_pref"]');
        if (select) select.selectedIndex = 0;
        let textInput = followupDiv.querySelector('input[name="discrim_work_pref"]');
        if (textInput) textInput.value = '';
      }
    }

    discrimInputs.forEach(input => {
      input.addEventListener('change', toggleFollowup);
    });

    toggleFollowup();
  });
</script>

{{ endblock }}
