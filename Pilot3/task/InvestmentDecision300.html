{{ block title }}
    Investment Decision
{{ endblock }}
{{ block content }}
<p>
You have an investment budget of 300 tokens. How many of these would you like to invest in the lottery?
</p>
<p>
<center>
    <u>Lottery</u><br><i>A fair six-sided die will be rolled. If the die lands on a 1 or a 2, you will
    win two and half times the amount you bet.
    If the die lands on a number higher than 2 (3, 4, 5 or 6), you will
    lose the amount you bet.</i>
</center>
</p>
   <p>
     Recall that the tokens you do not invest are yours to keep on top the returns from your investment in the lottery.
     Half tokens are rounded up.
     The die is rolled independently for each participant.
   </p>
<center>

    <form id="investment_form" method="post">
        <input
            type="number"
            id="tokens_input"
            name="investment300"
            min="0"
            max="300"
            step="1"
            style="width:80px;"
            autocomplete="off"
            required
        >
        <br><br>
        <div id="dynamic_message" style="font-weight:normal; color: #333;"></div>
        <div id="error_message" style="color: red; font-weight: bold; margin-top:10px;"></div>
        <br>
        <button type="submit">Submit</button>
    </form>
</center>

<script>
const input = document.getElementById('tokens_input');
const dynamicDiv = document.getElementById('dynamic_message');
const errorDiv = document.getElementById('error_message');
const form = document.getElementById('investment_form');

input.addEventListener('input', function() {
    errorDiv.textContent = '';
    let invested = Number(this.value);
    if (
        Number.isInteger(invested) &&
        invested >= 0 &&
        invested <= 300
    ) {
        let uninvested = 300 - invested;
        let bonusAmount = uninvested + Math.ceil(2.5 * invested);
        let bonusPayment = Math.ceil(bonusAmount)/100
        let uninvestedPayment = Math.ceil(uninvested)/100
     dynamicDiv.textContent =
    "You have a 1/3 chance of receiving a bonus equal to " + bonusAmount + " tokens (worth $" + bonusPayment + ") " +
    "and a 2/3 chance of receiving a bonus equal to " + uninvested + " tokens (worth $" + uninvestedPayment + ").";
    } else {
        dynamicDiv.textContent = '';
    }
});

form.addEventListener('submit', function(event) {
    let value = input.value;
    if (
        !value ||
        !/^\d+$/.test(value) ||
        Number(value) < 0 ||
        Number(value) > 300
    ) {
        errorDiv.textContent = 'Please type in a whole number between 0 and 300';
        event.preventDefault();
    } else {
        errorDiv.textContent = '';
    }
});
</script>
</center>

{{ endblock }}
